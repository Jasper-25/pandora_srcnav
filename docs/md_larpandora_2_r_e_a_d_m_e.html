<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pandora: LArPandora (last updated on 16th December 2014)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Pandora
   </div>
   <div id="projectbrief">Pandora source code navigator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_larpandora_2_r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">LArPandora (last updated on 16th December 2014)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="larpandora-last-updated-on-16th-december-2014"></a> Primary authors: Andy Blake, John Marshall, Mark Thomson (Cambridge University)</p>
<p>This code is part of the Liquid Argon Software (LArSoft) project. It contains simulation and reconstruction algorithms for LAr TPC detectors. If you have a problem, please log a redmine issue: <a href="https://cdcvs.fnal.gov/redmine/projects/larsoft/issues/new">https://cdcvs.fnal.gov/redmine/projects/larsoft/issues/new</a></p>
<h1><a class="anchor" id="dependencies"></a>
Dependencies</h1>
<div class="fragment"><div class="line">larpandora</div>
<div class="line">|__larpandoracontent</div>
<div class="line">|__larreco</div>
<div class="line">   |__larsim</div>
<div class="line">   |  |__larg4</div>
<div class="line">   |  |  |__larevt</div>
<div class="line">   |  |  |  |__lardata</div>
<div class="line">   |  |  |  |  |__larcore</div>
<div class="line">   |  |  |  |  |  |__larcorealg</div>
<div class="line">   |  |  |  |  |     |__larcoreobj</div>
<div class="line">   |  |  |  |  |__lardataalg</div>
<div class="line">   |  |  |  |  |  |__lardataobj</div>
<div class="line">   |  |  |  |  |__larvecutils</div>
</div><!-- fragment --><h1><a class="anchor" id="overview"></a>
Overview</h1>
<p>The larpandora repository contains the interfaces and algorithms for running the Pandora reconstruction chain within LArSoft. Pandora provides a highly modular approach to event reconstruction in fine-grain detectors, using a series of focused algorithms to reconstruct the particle flow of an event. This Particle Flow approach has now been implemented for LAr-TPC event reconstruction within LArSoft. The Pandora reconstruction currently supports the MicroBooNE and LBNE 35t detector geometries.</p>
<p>The Pandora LAr-TPC reconstruction chain takes as its input 2D hits and builds a set of 3D particles. The reconstruction chain runs within the lightweight framework supplied by the Pandora Software Development Kit (SDK), which manages the algorithms and provides a set of APIs for controlled memory management. The LAr-TPC algorithms themselves are developed and housed within LArSoft, and are run inside LArSoft using an ART Producer module, which inputs recob::Hit objects and outputs recob::PFParticle objects. The aim is to return one reconstructed particle for each true final-state particle in the event. The reconstruction also returns the parent/daughter hierarchy of particle associations (representing the particle flow of the event), along with a series of ART associations to low-level objects (recob::Cluster, recob::Seed, recob::SpacePoint).</p>
<p>The following sections provide notes on the two packages within the larpandora repository, LArPandoraAlgorithms and LArPandoraInterface, which support the pattern recognition algorithms and ART/LArSoft inputs/outputs respectively. Also included are instructions for running the Pandora reconstruction within LArSoft.</p>
<h1><a class="anchor" id="packages"></a>
Packages</h1>
<h2><a class="anchor" id="larpandoraalgorithms"></a>
LArPandoraAlgorithms</h2>
<p>This package houses all the LAr-TPC specific helper functions and pattern recognition algorithms (note that this package only depends on the underlying Pandora SDK and so can exist both inside and outside LArSoft). The package is currently divided into a number of sub-directories, corresponding to different aspects of LAr-TPC reconstruction (e.g. 2D and 3D).</p>
<h2><a class="anchor" id="larpandorainterface"></a>
LArPandoraInterface</h2>
<p>This package contains the interface between ART/LArSoft and the Pandora SDK. The central component is an ART Producer module that reads in recob::Hit objects from the ART framework, passes them to the Pandora SDK for pattern recognition, and then writes the reconstructed proto-particles back to the ART framework as recob::PFParticle objects. The LArPandoraInterface package holds a number of additional Producer and Analyzer modules that manipulate and analyse the reconstructed recob::PFParticle objects. Also distributed in this packages are .fcl scripts for configuring and running the Producer modules, and a number of Pandora .xml steering files, which are loaded into Pandora by the Producer module and define the order and configuration of the pattern recognition algorithms.</p>
<h2><a class="anchor" id="pandora-sdk-note-external-package"></a>
Pandora SDK (Note: external package).</h2>
<p>This external package houses a lightweight framework for running pattern recognition algorithms and performing memory management operations. The Pandora SDK also supplies design-pattern algorithms and helper functions that are used in building the MicroBooNE and LBNE reconstruction chains. Note that the LAr-TPC specific algorithms and helpers live in the LArPandoraAlgorithms package of LArSoft.</p>
<h1><a class="anchor" id="instructions"></a>
Instructions</h1>
<h2><a class="anchor" id="running-the-reconstruction"></a>
Running the reconstruction</h2>
<p>Taking an example for MicroBooNE, the LArPandoraInterface package in larpandora contains a script "runpandora_microboone.fcl" that can be used to process collections of reconstructed 2D hits. This script inputs these hits and runs the pattern recognition. It is run as follows:</p>
<div class="fragment"><div class="line">lar -c runpandora_microboone.fcl /path/to/file/of/reconstructed/hits.root</div>
</div><!-- fragment --><p>For completeness, here is the current version of the runpandora_microboone.fcl file in full.</p>
<div class="fragment"><div class="line">#include &quot;services_microboone.fcl&quot;</div>
<div class="line">#include &quot;pandoramodules_microboone.fcl&quot;</div>
<div class="line"> </div>
<div class="line">process_name: LArPandora</div>
<div class="line"> </div>
<div class="line">### SERVICES ###</div>
<div class="line">services:</div>
<div class="line">{</div>
<div class="line">  message:      @local::standard_debug</div>
<div class="line">  user:         @local::microboone_services</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">### INPUT ###</div>
<div class="line">source:</div>
<div class="line">{</div>
<div class="line">  module_type: RootInput</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">### MODULES ###</div>
<div class="line">physics:</div>
<div class="line">{</div>
<div class="line">  producers: </div>
<div class="line">  {  </div>
<div class="line">    pandora:    @local::microboone_pandora </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  reco: [pandora]</div>
<div class="line"> </div>
<div class="line">  trigger_paths: [reco]</div>
<div class="line">}</div>
</div><!-- fragment --><p>(Note: this script will be moved to the uboonecode repository in due course)</p>
<h2><a class="anchor" id="build-instructions-for-pandora-sdk-and-monitoring-packages"></a>
Build instructions for Pandora SDK and Monitoring packages</h2>
<p>The larpandora repository depends on the Pandora SDK. In addition to the SDK, there is also an optional Pandora Monitoring package, which depends on ROOT. Both packages can be downloaded from the "Pandora SVN repository":<a href="https://svnsrv.desy.de/public/PandoraPFANew/">https://svnsrv.desy.de/public/PandoraPFANew/</a> which is hosted at "DESY":<a href="https://svnsrv.desy.de">https://svnsrv.desy.de</a>. The packages are also installed in the /grid/fermiapp area at Fermilab. Here are a set of instructions for checking put and building the SDK and Monitoring packages:</p>
<div class="fragment"><div class="line">### STEP 0 (SET UP ROOT)</div>
<div class="line">source /grid/fermiapp/products/uboone/setup_uboone.sh</div>
<div class="line">setup root</div>
<div class="line"> </div>
<div class="line">### STEP 1 (SET UP ENVIRONMENT)</div>
<div class="line">export MY_INSTALLATION=/path/to/my/installation/directory</div>
<div class="line"> </div>
<div class="line">export PANDORA_VERSION=v00-17</div>
<div class="line">export PANDORA_DIR=${MY_INSTALLATION}/PandoraPFA</div>
<div class="line">export PANDORA_INC=${PANDORA_DIR}/include</div>
<div class="line">export PANDORA_LIB=${PANDORA_DIR}/lib</div>
<div class="line"> </div>
<div class="line">export PATH=${PANDORA_INC}:${PATH}</div>
<div class="line">export LD_LIBRARY_PATH=${PANDORA_LIB}:${LD_LIBRARY_PATH}</div>
<div class="line"> </div>
<div class="line">### STEP 2 (CHECK OUT AND BUILD PANDORA)</div>
<div class="line">svn co https://svnsrv.desy.de/public/PandoraPFANew/PandoraPFANew/tags/${PANDORA_VERSION} ${PANDORA_DIR}</div>
<div class="line">svn co https://svnsrv.desy.de/public/PandoraPFANew/PandoraSDK/tags/${PANDORA_VERSION} ${PANDORA_DIR}/PandoraSDK</div>
<div class="line">svn co https://svnsrv.desy.de/public/PandoraPFANew/PandoraMonitoring/tags/${PANDORA_VERSION} ${PANDORA_DIR}/PandoraMonitoring</div>
<div class="line"> </div>
<div class="line">cd ${PANDORA_DIR}</div>
<div class="line">make MONITORING=1 </div>
<div class="line">make install MONITORING=1 INCLUDE_TARGET=${PANDORA_INC}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.10.0-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
    <ul>
    </ul>
  </div>
  </body>
  </html>